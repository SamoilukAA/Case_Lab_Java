# Case_Lab_Java
# 1. Описание решения
Реализован микросервис на Spring Boot, который выполняет роль хранилица файлов и их атрибутов. При выполнении post-запроса файл и его аттрибуты сохраняются в БД PostgreSQL. При выполнении get-запроса микросервис возвращает данные в формате json.  
В классе FileInfo содержатся поля, которые возвращает микросервис: id файла, сам файл в формате base64, дата и время создания запроса, краткое описание файла.  
Класс FileController - обработчик входящих rest-запросов. В нем есть два метода: getFile() - получение файла из БД по id (значение id берется из адреса); createFile() - создание файла и сохранение его в БД (данные, которые необходимо записать в БД передаются в теле запроса).  
Класс FileController вызывает соответствующие методы класса FileService (содержит уровень бизнес-логики), которые в свою очередь вызывают методы класса FileRepository.  
Класс FileRepository реализует работу с БД, содержит три метода: Optional<FileInfo> getFileById(int id) - при поиске по id возвращается Optional: то есть объект может быть в базе, а может и не быть; void insertFile(String file_base64, String description) - вставка записи в таблицу; int getFileId() - получение id последнего созданного файла.  
Таким образом получилась трехслойная архитектура: контроллер (с аннотацией @Controller) -> сервис (@Service) -> dao (@Repository). Контроллер отвечает за маппинг входящих http-запросов, сервисный слой реализует бизнес-логику, а dao работает непосредственно с БД.  
При попытке получить файл и атрибуты по несуществующему id, микросервис выдаст json с описанием ошибки.  
# 2. Инструкция по запуску приложения
Программа выполнена в среде разработки IntelliJ IDEA Ultimate c использованием JDK Development Kit 22.0.2.  
Для работы микросервиса необходима БД с названием "file_storage", владельцем которой является пользователь root (в pgAdmin 4 создать новую Роль входа/группы с именем "root" и паролем "qwerty123", далее создать базу данных).  
Для создания исполняемого jar-файла выполнить команду mvn package в командной строке.  
Для запуска приложения выполнить команду java -jar target/Case_Lab_Java-0.0.1-SNAPSHOT.jar.  
# 3. Примеры тестовых запросов для проверки API-методов
### Запрос на создание новой записи в БД
Post-запрос выполняется по адресу http://localhost:8080/files.  
В http-заголовках обязательно указать Content-Type: application/json.  
Тело запроса:  
{  
    "file_base64": "SGVsbG8gV29ybGQh",  
    "description": "Hello"  
}  
В случае успеха в ответ получаем http-статус 201 и json c id созданной записи:  
{  
    "id": 1  
}  
![изображение](https://github.com/user-attachments/assets/67c2cfda-fa5a-446d-af7d-9af468610173)

### Запрос на получение существующей записи по id
Get-запрос выполняется по адресу http://localhost:8080/files/{fileId}, где fileId - id необходимой записи.  
Например, если выполнить запрос по адресу http://localhost:8080/files/1, получим ответ в виде:  
{  
    "id": 1,  
    "file_base64": "SGVsbG8gV29ybGQh",  
    "creation_date": "2024-09-01T16:50:13.4714095",  
    "description": "Hello"  
}  
![изображение](https://github.com/user-attachments/assets/15fbe7fa-e623-443d-bd2d-e73f60bae758)

### Запрос на получение несуществующей записи по id
Если записи с указанным id не существует, то при запросе http://localhost:8080/files/111 получим ответ:  
{  
    "message": "File with id = 111 not found"  
}  
![изображение](https://github.com/user-attachments/assets/83711ab3-0caf-4f14-b520-61b50bce9e58)

